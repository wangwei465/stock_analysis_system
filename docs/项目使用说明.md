# A股智能分析系统 - 使用说明文档

## 目录

- [系统概述](#系统概述)
- [环境要求](#环境要求)
- [快速开始](#快速开始)
- [功能模块](#功能模块)
- [API接口说明](#api接口说明)
- [常见问题](#常见问题)

---

## 系统概述

本系统是一个专业的A股股票分析平台，提供以下核心功能：

| 功能模块 | 描述 |
|---------|------|
| **股票行情** | 实时行情、K线图、分时图 |
| **技术指标** | MA、MACD、RSI、KDJ、布林带等 |
| **智能预测** | 基于ML的价格方向预测、价格区间预测、综合交易信号 |
| **情感分析** | 新闻情感分析、市场情绪评估 |
| **投资组合** | 组合管理、持仓跟踪、交易记录、收益统计 |
| **策略回测** | 多种策略回测、性能指标分析 |
| **股票筛选** | 多条件筛选、板块过滤 |
| **市场指标** | 巴菲特指标、股债利差 |

### 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                      前端 (React + TypeScript)               │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ Ant     │ │ Light-  │ │ Zustand │ │ Axios   │           │
│  │ Design  │ │ weight  │ │ (状态)   │ │ (HTTP)  │           │
│  │ (UI)    │ │ Charts  │ │         │ │         │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      后端 (FastAPI + Python)                 │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ SQLModel│ │ AKShare │ │ LightGBM│ │ Pandas  │           │
│  │ (ORM)   │ │ (数据源) │ │ (ML)    │ │ (分析)   │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
│                              │                               │
│                              ▼                               │
│              ┌─────────────────────────┐                    │
│              │   SQLite (数据库/缓存)   │                    │
│              └─────────────────────────┘                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 环境要求

### 后端环境

| 依赖 | 版本要求 |
|-----|---------|
| Python | >= 3.9 |
| FastAPI | >= 0.100.0 |
| SQLModel | >= 0.0.8 |
| AKShare | >= 1.10.0 |
| Pandas | >= 2.0.0 |
| NumPy | >= 1.24.0 |
| LightGBM | >= 4.0.0 (可选) |

### 前端环境

| 依赖 | 版本要求 |
|-----|---------|
| Node.js | >= 18.0.0 |
| npm/yarn | 最新版 |
| React | >= 18.0.0 |
| TypeScript | >= 5.0.0 |

---

## 快速开始

### 1. 克隆项目

```bash
git clone <repository-url>
cd stock_analysis_system
```

### 2. 启动后端

```bash
# 进入后端目录
cd backend

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 启动服务
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 3. 启动前端

```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 4. 访问应用

- **前端界面**: http://localhost:5173
- **API文档**: http://localhost:8000/docs
- **API备用文档**: http://localhost:8000/redoc

---

## 功能模块

### 1. 首页仪表板

**访问路径**: `/`

**功能说明**:
- 市场概览：大盘指数、涨跌统计
- 投资组合摘要：总资产、收益率
- 快速股票搜索

### 2. 股票详情

**访问路径**: `/stock/:code`

**功能说明**:
- **K线图**: 支持日/周/月K线切换
- **技术指标**: MA、MACD、RSI、KDJ、布林带
- **实时行情**: WebSocket实时推送
- **分时图**: 当日分时走势

**操作指南**:
1. 在搜索框输入股票代码或名称
2. 点击搜索结果进入详情页
3. 使用图表工具进行缩放、拖拽
4. 切换不同技术指标进行分析

### 3. 智能预测

**访问路径**: `/prediction`

**功能说明**:
- **价格方向预测**: 预测未来涨跌方向
- **价格区间预测**: 预测未来价格区间
- **综合交易信号**: 买入/卖出/持有信号
- **情感分析**: 新闻情绪评估

**预测参数**:
| 参数 | 说明 | 默认值 |
|-----|------|--------|
| 预测天数 | 1-20天 | 5天 |
| 风险偏好 | conservative/moderate/aggressive | moderate |

**结果解读**:
- 置信度 > 70%: 信号较强
- 置信度 50-70%: 信号中等
- 置信度 < 50%: 信号较弱

### 4. 预测记录

**访问路径**: `/prediction-records`

**功能说明**:
- 查看历史预测记录
- 追踪预测准确度
- 统计预测成功率

### 5. 投资组合

**访问路径**: `/portfolio`

**功能说明**:
- **组合管理**: 创建/编辑/删除投资组合
- **持仓管理**: 添加/调整/删除持仓
- **交易记录**: 买入/卖出/分红/税费
- **收益统计**: 盈亏计算、收益率分析

**交易类型**:
| 类型 | 说明 |
|-----|------|
| BUY | 买入 |
| SELL | 卖出 |
| DIVIDEND | 分红 |
| TAX | 税费 |

**导入功能**:
支持CSV格式导入交易记录，格式如下：
```csv
code,trade_type,quantity,price,commission,trade_date
600519,BUY,100,1800.00,5.00,2024-01-15
```

### 6. 股票筛选

**访问路径**: `/screener`

**功能说明**:
- 多条件筛选
- 板块过滤
- 实时行情排序

**筛选条件**:
| 条件 | 说明 |
|-----|------|
| 涨跌幅 | 日涨跌幅范围 |
| 市值 | 总市值范围 |
| 市盈率 | PE范围 |
| 换手率 | 换手率范围 |
| 成交量 | 成交量筛选 |

### 7. 策略回测

**访问路径**: `/backtest`

**功能说明**:
- 选择回测策略
- 配置策略参数
- 查看回测结果

**可用策略**:
| 策略 | 说明 |
|-----|------|
| MA交叉策略 | 短期均线上穿/下穿长期均线 |
| 双均线策略 | 价格与均线的关系 |
| MACD策略 | MACD金叉/死叉 |
| RSI策略 | RSI超买超卖 |
| KDJ策略 | KDJ金叉/死叉 |
| 布林带策略 | 价格触及布林带上下轨 |

**回测指标**:
| 指标 | 说明 |
|-----|------|
| 总收益率 | 策略期间总收益 |
| 年化收益率 | 年化后的收益率 |
| 最大回撤 | 最大亏损幅度 |
| 夏普比率 | 风险调整后收益 |
| 胜率 | 盈利交易占比 |

### 8. 巴菲特指标

**访问路径**: `/buffett-index`

**功能说明**:
- 查看历史巴菲特指标
- 当前市场估值水平
- 投资建议参考

**指标解读**:
| 区间 | 含义 |
|-----|------|
| < 70% | 市场被低估，投资机会 |
| 70-100% | 市场合理估值 |
| > 100% | 市场被高估，需谨慎 |

### 9. 股债利差

**访问路径**: `/equity-bond-spread`

**功能说明**:
- 股债利差历史走势
- 当前利差水平分析
- 资产配置建议

**指标解读**:
- 利差高于均线 + 标准差: 股票相对债券更具吸引力
- 利差低于均线 - 标准差: 债券相对股票更具吸引力

---

## API接口说明

### 基础URL

```
http://localhost:8000/api/v1
```

### 认证

当前版本无需认证，所有接口公开访问。

### 主要接口

#### 股票数据

```
GET  /stocks/search?keyword={keyword}     # 搜索股票
GET  /stocks/{code}                       # 股票信息
GET  /stocks/{code}/kline?period={period} # K线数据
GET  /stocks/{code}/quote                 # 实时行情
```

#### 技术指标

```
GET  /indicators/{code}/ma    # 移动平均线
GET  /indicators/{code}/macd  # MACD
GET  /indicators/{code}/rsi   # RSI
GET  /indicators/{code}/kdj   # KDJ
GET  /indicators/{code}/boll  # 布林带
```

#### 智能预测

```
POST /ml/predict                    # 综合预测
GET  /ml/direction/{code}           # 方向预测
GET  /ml/price-range/{code}         # 价格区间
GET  /ml/sentiment/{code}           # 情感分析
```

#### 投资组合

```
GET    /portfolios/            # 组合列表
POST   /portfolios/            # 创建组合
GET    /portfolios/{id}        # 组合详情
POST   /portfolios/{id}/buy    # 买入
POST   /portfolios/{id}/sell   # 卖出
```

完整API文档请访问: http://localhost:8000/docs

---

## 常见问题

### Q1: 后端启动报错 "ModuleNotFoundError"

**解决方案**:
```bash
pip install -r requirements.txt
```

### Q2: 前端无法连接后端

**解决方案**:
1. 确认后端服务已启动
2. 检查后端端口是否为8000
3. 检查前端API配置 (`frontend/src/api/client.ts`)

### Q3: 股票数据加载缓慢

**解决方案**:
1. 首次访问需要从AKShare获取数据，较慢是正常的
2. 系统会自动缓存数据，后续访问会更快
3. 可以使用缓存预热功能: `POST /api/v1/cache/warm`

### Q4: 智能预测显示"数据不足"

**解决方案**:
- 预测功能需要至少60个交易日的历史数据
- 新上市股票可能数据不足

### Q5: WebSocket连接失败

**解决方案**:
1. 确认后端WebSocket服务正常
2. 检查浏览器是否支持WebSocket
3. 检查网络代理设置

### Q6: 数据库错误

**解决方案**:
```bash
# 删除数据库重建
rm backend/data/stock.db
# 重启后端服务
```

---

## 目录结构

```
stock_analysis_system/
├── backend/                    # 后端代码
│   ├── app/
│   │   ├── api/v1/            # API接口
│   │   ├── core/              # 核心功能
│   │   ├── ml/                # 机器学习模块
│   │   ├── models/            # 数据模型
│   │   ├── schemas/           # 数据验证
│   │   ├── sentiment/         # 情感分析
│   │   └── backtest/          # 回测引擎
│   ├── data/                  # 数据存储
│   └── requirements.txt       # Python依赖
│
├── frontend/                   # 前端代码
│   ├── src/
│   │   ├── api/               # API客户端
│   │   ├── components/        # React组件
│   │   ├── pages/             # 页面
│   │   ├── store/             # 状态管理
│   │   └── types/             # TypeScript类型
│   └── package.json           # Node依赖
│
└── docs/                       # 文档
    ├── 项目使用说明.md
    ├── 智能预测算法说明.md
    └── ...
```

---

## 版本信息

- **版本**: 1.0.0
- **更新日期**: 2024年1月
- **技术支持**: AI Stock Analysis System

---

## 免责声明

1. 本系统仅供学习和研究使用，不构成任何投资建议
2. 股市有风险，投资需谨慎
3. 历史数据不能预测未来，请结合多方信息做出投资决策
4. 使用者需自行承担使用本系统带来的任何风险
