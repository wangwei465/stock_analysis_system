# 智能预测算法说明文档

## 概述

本系统的智能预测功能采用多维度综合分析方法，整合**技术指标分析**、**趋势分析**、**动量分析**、**波动率分析**和**成交量分析**五大模块，生成股票走势预测和交易信号。

---

## 一、预测系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    ComprehensivePredictor                        │
│                       (综合预测器)                                │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ QuickPredict │  │ PriceRange   │  │ SignalGen    │          │
│  │ ionModel     │  │ Predictor    │  │ erator       │          │
│  │ (方向预测)    │  │ (价格区间)    │  │ (信号生成)    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│         │                 │                 │                   │
│         ▼                 ▼                 ▼                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              IndicatorCalculator (技术指标计算器)         │   │
│  │  MA | EMA | MACD | RSI | KDJ | BOLL | ATR | Volume MA    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 二、方向预测模型 (QuickPredictionModel)

### 2.1 模型原理

基于多个技术指标的综合评分，判断股票短期走势方向（看涨/看跌/震荡）。

### 2.2 参考指标及权重

| 指标 | 信号条件 | 评分 |
|------|----------|------|
| **MA趋势** | MA5 > MA20（多头排列） | +1.0 |
|            | MA5 < MA20（空头排列） | -1.0 |
| **RSI(14)** | RSI < 30（超卖） | +0.5 |
|             | RSI > 70（超买） | -0.5 |
|             | RSI > 50（偏强） | +0.3 |
|             | RSI < 50（偏弱） | -0.3 |
| **MACD柱** | 红柱增长 | +1.0 |
|            | 红柱缩短 | +0.3 |
|            | 绿柱增长 | -1.0 |
|            | 绿柱缩短 | -0.3 |
| **KDJ** | K > D 且 K < 80（金叉） | +0.5 |
|         | K < D 且 K > 20（死叉） | -0.5 |
|         | K > 80（超买区） | -0.3 |
|         | K < 20（超卖区） | +0.3 |
| **成交量** | 放量上涨（量比>2且涨） | +0.5 |
|           | 放量下跌（量比>2且跌） | -0.5 |

### 2.3 方向判定规则

```
综合得分 = Σ(各指标评分) / 指标数量

if 综合得分 > 0.3:
    方向 = "看涨"
elif 综合得分 < -0.3:
    方向 = "看跌"
else:
    方向 = "震荡"

置信度 = min(|综合得分|, 1.0)
```

---

## 三、交易信号生成器 (SignalGenerator)

### 3.1 信号类型

| 信号 | 数值 | 说明 |
|------|------|------|
| 强烈买入 | +2 | 多项指标强烈看涨 |
| 买入 | +1 | 指标整体偏多 |
| 持有/观望 | 0 | 信号不明确 |
| 卖出 | -1 | 指标整体偏空 |
| 强烈卖出 | -2 | 多项指标强烈看跌 |

### 3.2 五维度分析模块

#### 3.2.1 技术指标分析 (权重: 30%)

| 指标 | 买入信号 | 卖出信号 | 评分范围 |
|------|----------|----------|----------|
| **RSI** | < 30 超卖 | > 70 超买 | ±0.4 |
|         | 低位回升 | 高位回落 | ±0.2 |
| **MACD** | 金叉（DIF上穿DEA） | 死叉（DIF下穿DEA） | ±0.5 |
|          | 红柱放大 | 绿柱放大 | ±0.2 |
| **KDJ** | J < 0 超卖 | J > 100 超买 | ±0.3 |
|         | 低位金叉(K<50) | 高位死叉(K>50) | ±0.3 |
| **布林带** | 触及下轨 | 触及上轨 | ±0.3 |

#### 3.2.2 趋势分析 (权重: 25%)

| 条件 | 买入信号 | 卖出信号 | 评分 |
|------|----------|----------|------|
| **均线排列** | MA5>MA10>MA20>MA60（多头） | MA5<MA10<MA20<MA60（空头） | ±0.5 |
| **价格位置** | 价格 > MA20 | 价格 < MA20 | ±0.2 |
| **MA20斜率** | 斜率 > 2% | 斜率 < -2% | ±0.2 |
| **线性回归** | 20日趋势斜率 > 0.5% | 20日趋势斜率 < -0.5% | ±0.3 |

#### 3.2.3 动量分析 (权重: 20%)

| 指标 | 买入条件 | 卖出条件 | 评分 |
|------|----------|----------|------|
| **5日收益率** | > 5% | < -5% | ±0.3 |
| **动量加速** | 当前>前5日 且 上涨 | 当前<前5日 且 下跌 | ±0.2 |
| **ROC(10)** | > 10% | < -10% | ±0.2 |

#### 3.2.4 波动率分析 (权重: 15%)

| 指标 | 条件 | 评分 |
|------|------|------|
| **年化波动率** | > 50%（高波动，风险大） | -0.2 |
|               | < 20%（低波动，稳定） | +0.1 |
| **波动率变化** | 当前 < 前期×0.7（收敛） | +0.1 |
|               | 当前 > 前期×1.5（扩大） | 0（仅警示） |

#### 3.2.5 成交量分析 (权重: 10%)

| 条件 | 信号 | 评分 |
|------|------|------|
| 量比 > 2 且 涨幅 > 2% | 放量上涨 | +0.4 |
| 量比 > 2 且 跌幅 > 2% | 放量下跌 | -0.4 |
| 量比 < 0.5 且 涨幅 > 2% | 缩量上涨 | +0.1 |
| 量比 < 0.5 且 跌幅 > 2% | 缩量下跌 | -0.1 |

### 3.3 综合信号计算

```python
总得分 = 技术指标得分 × 0.30
       + 趋势得分 × 0.25
       + 动量得分 × 0.20
       + 波动率得分 × 0.15
       + 成交量得分 × 0.10

# 风险偏好参数 (默认 moderate)
阈值 = 0.4  # conservative=0.6, aggressive=0.2

if 总得分 >= 阈值 × 2:
    信号 = "强烈买入"
elif 总得分 >= 阈值:
    信号 = "买入"
elif 总得分 <= -阈值 × 2:
    信号 = "强烈卖出"
elif 总得分 <= -阈值:
    信号 = "卖出"
else:
    信号 = "持有/观望"
```

### 3.4 止损止盈计算

基于 **ATR (Average True Range)** 计算：

```python
ATR = 14日真实波幅均值

# 买入信号时
止损位 = 当前价格 - ATR × 止损倍数
止盈位 = 当前价格 + ATR × 止盈倍数

# 风险偏好对应的ATR倍数
┌────────────┬──────────┬──────────┐
│ 风险偏好    │ 止损倍数  │ 止盈倍数  │
├────────────┼──────────┼──────────┤
│ conservative│   1.5    │   2.0    │
│ moderate    │   2.0    │   3.0    │
│ aggressive  │   2.5    │   4.0    │
└────────────┴──────────┴──────────┘

盈亏比 = 止盈倍数 / 止损倍数
```

---

## 四、价格区间预测 (QuickPriceRangePredictor)

### 4.1 模型原理

基于历史波动率，使用正态分布假设预测未来价格区间。

### 4.2 波动率计算

```python
# 日波动率
日波动率 = 日收益率标准差

# 年化波动率 (假设252个交易日)
年化波动率 = 日波动率 × √252

# 预测期波动率 (根号时间法则)
N日波动率 = 日波动率 × √N
```

### 4.3 置信区间计算

| 置信水平 | Z值 | 说明 |
|----------|-----|------|
| 68% | 1.00 | 1个标准差 |
| 90% | 1.645 | 常用置信水平 |
| 95% | 1.96 | 统计学常用 |
| 99% | 2.576 | 高置信水平 |

```python
价格区间下限 = 当前价格 × (1 - Z值 × N日波动率)
价格区间上限 = 当前价格 × (1 + Z值 × N日波动率)
```

### 4.4 预期价格计算

```python
# 基于近期收益趋势
近期日均收益 = 近20日收益率均值
预期收益 = 近期日均收益 × 预测天数
预期价格 = 当前价格 × (1 + 预期收益)
```

### 4.5 支撑阻力位

```python
阻力位 = 近20日最高价
支撑位 = 近20日最低价
```

---

## 五、风险评估指标

### 5.1 波动率指标

| 指标 | 计算方法 | 说明 |
|------|----------|------|
| 日波动率 | 日收益率标准差 | 每日价格波动程度 |
| 年化波动率 | 日波动率 × √252 | 年度波动水平 |

### 5.2 回撤指标

```python
# 20日最大回撤
最大回撤 = (近20日累计最高价 - 当前价格) / 近20日累计最高价
```

### 5.3 风险价值 (VaR)

| 指标 | 计算方法 | 含义 |
|------|----------|------|
| VaR(95%) | 收益率5%分位数 | 95%概率下的最大损失 |
| CVaR(95%) | 低于VaR的平均损失 | 极端情况下的平均损失 |

### 5.4 波动率水平分类

| 年化波动率 | 等级 |
|------------|------|
| > 40% | 高波动 |
| 20% - 40% | 中波动 |
| < 20% | 低波动 |

---

## 六、综合建议生成

### 6.1 评分合成

```python
综合评分 = (方向预测得分 + 信号得分) / 2
```

### 6.2 建议映射

| 综合评分 | 操作建议 | 风险等级 |
|----------|----------|----------|
| > 0.5 | 积极买入 | 中等 |
| 0.2 ~ 0.5 | 适度买入 | 较低 |
| -0.2 ~ 0.2 | 观望 | 低 |
| -0.5 ~ -0.2 | 减仓 | 中等 |
| < -0.5 | 建议卖出 | 较高 |

---

## 七、技术指标计算公式

### 7.1 移动平均线 (MA)

```
MA(N) = (C₁ + C₂ + ... + Cₙ) / N
```
其中 C 为收盘价，N 为周期。

### 7.2 MACD

```
DIF = EMA(12) - EMA(26)
DEA = EMA(DIF, 9)
MACD柱 = (DIF - DEA) × 2
```

### 7.3 RSI

```
RS = 平均上涨幅度 / 平均下跌幅度
RSI = 100 - 100 / (1 + RS)
```

### 7.4 KDJ

```
RSV = (收盘价 - N日最低价) / (N日最高价 - N日最低价) × 100
K = EMA(RSV, M1)
D = EMA(K, M2)
J = 3K - 2D
```
默认参数：N=9, M1=3, M2=3

### 7.5 布林带

```
中轨 = MA(20)
上轨 = 中轨 + 2 × 标准差(20)
下轨 = 中轨 - 2 × 标准差(20)
```

### 7.6 ATR (真实波幅)

```
TR = max(H-L, |H-C₋₁|, |L-C₋₁|)
ATR = MA(TR, 14)
```

---

## 八、使用说明

### 8.1 数据要求

- **最小数据量**: 60个交易日
- **数据字段**: open, high, low, close, volume
- **数据频率**: 日K线

### 8.2 预测周期

- **支持范围**: 1-20个交易日
- **推荐周期**: 5-10个交易日
- **周期越长，不确定性越大**

### 8.3 风险偏好设置

| 偏好 | 适用人群 | 信号灵敏度 |
|------|----------|------------|
| conservative | 稳健型投资者 | 低（信号更谨慎） |
| moderate | 平衡型投资者 | 中（默认） |
| aggressive | 激进型投资者 | 高（信号更敏感） |

---

## 九、免责声明

1. 本预测系统仅供参考，不构成投资建议
2. 历史数据不能预测未来，市场存在不可预知风险
3. 技术分析存在局限性，应结合基本面分析
4. 投资有风险，入市需谨慎
5. 使用者需自行承担投资决策带来的盈亏

---

## 十、版本信息

- **版本**: 1.0.0
- **更新日期**: 2024年1月
- **作者**: AI Stock Analysis System

---

## 附录：信号权重汇总表

| 模块 | 权重 | 评分范围 | 主要指标 |
|------|------|----------|----------|
| 技术指标 | 30% | [-1, 1] | RSI, MACD, KDJ, BOLL |
| 趋势分析 | 25% | [-1, 1] | MA排列, MA斜率, 线性回归 |
| 动量分析 | 20% | [-1, 1] | 收益率, ROC, 动量加速 |
| 波动率 | 15% | [-1, 1] | 年化波动率, 波动率变化 |
| 成交量 | 10% | [-1, 1] | 量比, 量价配合 |
